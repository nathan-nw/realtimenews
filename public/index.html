<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News Highlights</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="highlights-bar">
        <div class="label">HIGHLIGHTS</div>
        <div class="ticker-mask">
            <div class="ticker-track" id="ticker-track">
                <!-- Items will be injected here -->
            </div>
        </div>
    </div>

    <script>
        const tickerTrack = document.getElementById('ticker-track');
        let headlights = [];

        function renderHeadlines() {
            tickerTrack.innerHTML = '';
            
            if (headlights.length === 0) {
                const item = document.createElement('div');
                item.className = 'ticker-item';
                item.innerHTML = `<span class="headline-text">Waiting for headlines...</span>`;
                tickerTrack.appendChild(item);
                return;
            }

            // Create items string
            let itemsHtml = '';
            headlights.forEach(item => {
                itemsHtml += `
                    <div class="ticker-item">
                        <a href="${item.url}" target="_blank" class="headline-text">${item.title}</a>
                        <span class="headline-source">â€” ${item.feed_title || 'Unknown'}</span>
                    </div>
                `;
            });

            // Duplicate content 10 times to ensure it fills the width and loops smoothly for a long time
            // A proper infinite loop usually involves cloning enough items to fill screen + buffer
            // For MVP, repeating the set multiple times is a simple cheat.
            // Better MVP approach for CSS logic: duplicate the ENTIRE set once, so we have [A B C] [A B C] and animation goes from 0% to -50%.
            
            tickerTrack.innerHTML = itemsHtml + itemsHtml; 
        }

        async function fetchHighlights() {
            try {
                const response = await fetch('/api/highlights');
                if (!response.ok) throw new Error('Network response was not ok');
                const data = await response.json();
                
                // Only update if data changed (simple string compare)
                if (JSON.stringify(data) !== JSON.stringify(headlights)) {
                    headlights = data;
                    renderHeadlines();
                }
            } catch (error) {
                console.error('Error fetching highlights:', error);
                if (headlights.length === 0) {
                    tickerTrack.innerHTML = '<div class="ticker-item"><span class="headline-text">Error loading headlines. env variable might be missing.</span></div>';
                }
            }
        }

        // Initial fetch
        fetchHighlights();

        // Fetch every 60 seconds
        setInterval(fetchHighlights, 60000);
    </script>
</body>
</html>
